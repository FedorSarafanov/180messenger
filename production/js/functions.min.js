(function(){var e="<a class='attached_tree nohover' target='_blank' href='/upload/{0}'>{0}<i class='icon-trash-empty'></i></a>",t=require("./underscore-min.js");module.exports.safe=function(e){return t.escape(e)};var n=new Object;n.day=function(){return(new Date).getDate()},n.month=function(){return(new Date).getMonth()+1},n.year=function(){return(new Date).getFullYear()},n.time=function(){return(new Date).toLocaleTimeString()},n.data=function(){return String(n.day()+"."+n.month()+"."+n.year())},module.exports.formatMSG=function(r,a){var i=function(){return"Всем"!=r.to?'<i class="icon-private"></i>':""}(),o=function(){return r.index}(),s=function(){return void 0!=r.id?r.id:""}(),c=function(){return module.exports.safe(r.title)[0]+". "+module.exports.safe(r.patronymic)[0]+". "+module.exports.safe(r.family)}(),u=function(){return void 0!=r.color?r.color:""}(),l=function(){return n.year()!=r.year|n.day()!=r.day|n.month()!=r.month?r.day+"."+r.month+"."+r.year:module.exports.safe(r.time)}(),m=function(){var n=JSON.parse(r.attach),a="";return 0!=n.length&&(a+="<br>",t.each(n,function(t){a+=e.format(t)})),a}(),d=function(){return r.from==a|"admin"==a?'<i title="Редактировать сообщение" class="icon-edit"></i><i title="Сохранить сообщение" class="icon-save"></i><i title="Удалить сообщение" class="icon-trash-empty"></i>':""}(),f=r.from,p=r.message.replace(/\n/g,"<br>"),h='<div class="msg" index={A} id={B} from="{2}">{0}<span class="user {9}">{1}</span><span class="aka"> @{2}</span> <span class="time">[{3}]</span>{7}<br>{4}{5}</div>';return h.format(i,c,f,l,p,m,r.time,d,r.message,u).replace("index={A}",'index="'+o+'"').replace("id={B}",'id="'+s+'"')}}).call(this);