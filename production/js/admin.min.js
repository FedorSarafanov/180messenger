"use strict";function reloadPage(){window.location.hostname=window.location.hostname}$(document).ready(function(){function n(){socket.emit("get_users_table",sessionStorage.from)}var e=$(".logout");$("body");socket.on("connecting",function(){}),$(".users").keypress(function(n){return console.log(n),13==n.keyCode?!1:void 0}),$(".add").click(function(n){var e="",s="",t="",a="",o="",r="",c=[];for($(".user").each(function(n,e){c.push($(e).find(".nick").text())});""==e|_.include(c,e.replace(/\ /g,""));)e=prompt("Введите логин пользователя","логин");for(;""==s;)s=prompt("Введите имя пользователя","");for(;""==t;)t=prompt("Введите отчество пользователя","");for(;""==a;)a=prompt("Введите фамилию пользователя","");for(;""==r;)r=prompt("Введите тип пользователя: администратор/учитель/ученик/директор/замдиректора/бухгалтер","");for(;""==o;)o=prompt("Введите пароль пользователя","");$(".users").append('<span class="user"><span class="no">{5}</span><span  class="nick">{0}</span><span  class="name">{1}</span><span  class="otch">{2}</span><span  class="family">{3}</span><span  class="type">{6}</span><span  class="password">{4}</span></span>'.format(e,s,t,a,o,"",r));var i=0;$(".user").each(function(n,e){i++,$(e).find(".no").text(String(i))})}),$(".users").on("click",".user",function(n){return $(this).toggleClass("selectable"),n.preventDefault(),!1}),$(".users").on("dblclick",".user",function(n){return $(this).children().each(function(n,e){$(e).attr("contenteditable","true")}),n.preventDefault(),!1}),$(".users").on("blur",".user",function(n){return $(this).children().each(function(n,e){$(e).attr("contenteditable","false")}),n.preventDefault(),!1}),$(".delete").click(function(n){$(".selectable").each(function(n,e){$(e).remove()});var e=0;$(".user").each(function(n,s){e++,$(s).find(".no").text(String(e))})}),socket.on("connect",function(){}),socket.on("set_users_table",function(n){var e=0;_.each(n,function(n,s){e++;var t='<span user="{0}" class="user"><span class="no">{5}</span><span  class="nick">{0}</span><span  class="name">{1}</span><span  class="otch">{2}</span><span  class="family">{3}</span><span  class="type">{6}</span><span  class="password">{4}</span></span>'.format(s,n["имя"],n["отчество"],n["фамилия"],n.pass,String(e),n.role);$(".users").append(t)})}),socket.on("failed_get_userstable",function(){$("body").empty(),$("body").html('<center><h1>ACCESS DENIED</h1><br><button onclick="sessionStorage.clear();reloadPage();">Зайти под другой учетной записью</button></center>')}),e.click(function(){sessionStorage.clear(),reloadPage()}),socket.on("failed",function(){sessionStorage.loginde="failed",console.log("Верификация не пройдена, соединение не разорвано."),$(".laypass").find("input").addClass("redBorder")}),socket.on("success",function(){sessionStorage.loginde="success",$(".laypass").find("input").removeClass("redBorder"),console.log("Верификация пройдена"),n()}),$(".test").click(function(){if($(".user").each(function(n,e){var s=[".nick",".otch",".name",".family",".type",".password"],t=$(e);_.each(s,function(n){""==t.find(n).text().replace(/\s+/g,"")?t.find(n).addClass("redBorder"):t.find(n).removeClass("redBorder")})}),0==$(".redBorder").length){var n={};$(".user").each(function(e,s){if("№"!=$(s).find(".no").text()){var t=String($(s).find(".nick").text()),a=String($(s).find(".name").text()),o=String($(s).find(".otch").text()),r=String($(s).find(".family").text()),c=String($(s).find(".type").text()),i=String($(s).find(".password").text());n[t]={"имя":a,"отчество":o,"фамилия":r,pass:i,role:c}}}),socket.emit("write_users_table",n),reloadPage()}}),login.session(n)});