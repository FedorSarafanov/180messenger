!function(){function e(e,t,a,n,o){var i='<div class="layq"><div class="center"><div class="warning">{0}</div><div class="buttons"><button class="warn" id="yes">{1}</button><button class="norm" id="cancel">{2}</button></div></div></div>';$("body").append(i.format(e,t,a)),$(".layq #yes").click(function(){n(),$(".layq").remove()}),$(".layq #cancel").click(function(){o(),$(".layq").remove()})}if(session()){window.provider={},_.extend(provider,Backbone.Events),provider.emit=provider.trigger,provider.on("rmFiles",function(){$(".selectable").each(function(e,t){var a=$(t);a.find(".c-nick").text()==sessionStorage.from|"admin"==sessionStorage.from&&(a.remove(),socket.emit("removeFile",a.find(".c-file").text()))})}),provider.on("udFile",function(e,t){var a=new FormData,n=new XMLHttpRequest,o=$("progress");n.upload.onprogress=function(e){var t=e.loaded/e.total*100;o.val(t),100==t&&o.val(0)};var s=function(e){if(this.readyState==this.DONE)if(200!=this.status)console.log("error !!!");else{var a=JSON.parse(n.responseText);t?attach_file(a.file):$(".c-title").after(i.format(a.file,a.file,a.from,a.data,formatSize(a.size)))}},r=function(e){console.log("Ошибка при загрузке ...")};a.append("files",e.target.files[0]),a.append("size",e.target.files[0].size),a.append("from",sessionStorage.from),a.append("data",clock.data()),a.append("desc",""),n.open("post","/files/upload",!0),n.addEventListener("error",r,!1),n.send(a),n.addEventListener("readystatechange",s,!1)});var t=$(".file_upload"),a=t.find("input"),n=t.find("div"),o=$("#upload_tocloud");o.focus(function(){t.addClass("focus")}).blur(function(){t.removeClass("focus")}),o.add(n).click(function(){a.attr("to","oblako"),a.click()}),$("[name=upload]").on("change",function(e){provider.emit("udFile",e,!1)});var i="<a class='attached attached_tree' target='_blank' href='/upload/{0}'><span class='c-file'>{1}</span><span class='c-nick'>{2}</span><span class='c-date'>{3}</span><span class='c-size'>{4}</span></a>",s="Вы собираетесь удалить файлы из облака. Данное действие необратимо! Если файлы были приклеплены к сообщениям, то ссылки на них будут нерабочими. Вы действительно хотите удалить эти файлы?",r="Да, эти файлы больше не нужны мне",l="Отмена";$(".files").on("click","a",function(e){$(this).toggleClass("selectable"),e.preventDefault()}),$("#removefiles").on("click",function(t){e(s,r,l,function(){provider.emit("rmFiles")},function(){return null}),t.preventDefault()}),socket.emit("cloud"),socket.on("file_to_cloud",function(e){$(".c-title").after(i.format(e.file,e.file,e.from,e.data,formatSize(e.size)))})}}();